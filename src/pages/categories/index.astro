---
import PageLayout from '../../layouts/PageLayout.astro';
import { getCategories, url } from '../../lib/utils';
import { getCollection } from 'astro:content';

const categories = getCategories();
const allPlants = await getCollection('plants', ({ data }) => !data.draft);

function countPlants(slug: string): number {
  return allPlants.filter((p) => p.data.category === slug || p.data.secondaryCategories.includes(slug as any)).length;
}
---

<PageLayout title="Categories" description="Browse plants by use case â€” bedroom, office, kitchen, wellness, and more.">
  <section class="max-w-6xl mx-auto px-4 sm:px-6 py-8 sm:py-12">
    <h1 class="text-2xl sm:text-3xl font-bold text-dark-text mb-2">Categories</h1>
    <p class="text-dark-text/60 mb-8">Find the perfect plant by where you want it to grow.</p>

    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
      {categories.map((cat) => {
        const count = countPlants(cat.slug);
        return (
          <a
            href={url(`/categories/${cat.slug}/`)}
            class="group flex flex-col p-5 sm:p-6 rounded-xl bg-dark-surface hover:bg-dark-elevated shadow-[var(--shadow-card)] hover:shadow-[var(--shadow-card-hover)] transition-all no-underline"
          >
            <span class="text-3xl mb-3">{cat.icon}</span>
            <h2 class="text-base font-medium text-dark-text group-hover:text-leaf-light transition-colors">{cat.name}</h2>
            <p class="text-xs text-dark-text/50 mt-1 line-clamp-2">{cat.description}</p>
            <p class="text-xs text-dark-text/30 mt-3">{count} {count === 1 ? 'plant' : 'plants'}</p>
          </a>
        );
      })}
    </div>
  </section>
</PageLayout>
