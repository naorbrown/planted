---
import PageLayout from '../../layouts/PageLayout.astro';
import ContentCard from '../../components/ui/ContentCard.astro';
import Breadcrumb from '../../components/ui/Breadcrumb.astro';
import { getCategories, categoryLabel, getCategoryIcon, url } from '../../lib/utils';
import { getCollection } from 'astro:content';

export async function getStaticPaths() {
  const categories = getCategories();
  return categories.map((cat) => ({
    params: { category: cat.slug },
    props: { category: cat },
  }));
}

const { category } = Astro.props;
const allPlants = await getCollection('plants', ({ data }) => !data.draft && (data.category === category.slug || data.secondaryCategories.includes(category.slug as any)));
const sorted = allPlants.sort((a, b) => a.data.title.localeCompare(b.data.title));

const breadcrumbs = [
  { label: 'Home', href: '/' },
  { label: 'Categories', href: '/categories/' },
  { label: category.name },
];
---

<PageLayout title={category.name} description={category.description}>
  <section class="max-w-6xl mx-auto px-4 sm:px-6 py-8 sm:py-12">
    <Breadcrumb items={breadcrumbs} />

    <div class="flex items-center gap-3 mt-4 mb-2">
      <span class="text-3xl">{category.icon}</span>
      <h1 class="text-2xl sm:text-3xl font-bold text-dark-text">{category.name}</h1>
    </div>
    <p class="text-dark-text/60 mb-8">{category.description}</p>

    {sorted.length > 0 ? (
      <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-5">
        {sorted.map((plant) => (
          <ContentCard
            href={url(`/plants/${plant.id}/`)}
            title={plant.data.title}
            description={plant.data.description}
            category={plant.data.category}
            petSafe={plant.data.petSafe}
            difficulty={plant.data.difficulty}
          />
        ))}
      </div>
    ) : (
      <p class="text-dark-text/50 text-center py-12">Plants coming soon for this category.</p>
    )}
  </section>
</PageLayout>
